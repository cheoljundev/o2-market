<!DOCTYPE html>
<html th:replace="~{layout/halfAdminLayout :: layout(~{::title}, ~{::main}, ~{::insertHead})}"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <title>주문건 확인</title>
    <th:block th:fragment="insertHead">
    </th:block>

</head>
<body>
<main class="flex-grow-1">
    <div class="container">
        <div class="row mb-5">
            <h2 class="text-center my-5 m-2 mb-4">주문건 확인</h2>
            <form action="" th:action="@{/admin/half/order}" class="px-0">
                <div class="row gx-2 mx-2 mb-4">
                    <div class="col-auto">
                        <select class="form-select col-auto search-select" name="searchField">
                            <option selected value="searchCond">검색 조건</option>
                            <option th:each="searchCond : ${searchConds}" th:text="${searchCond.name}" th:value="${searchCond.field}" th:selected="${searchCond.field == searchField}">검색조건</option>
                        </select>
                    </div>
                    <div class="col-auto">
                        <input class="form-control col-auto search-input" type="text" th:value="${searchValue}" placeholder="입력하세요.">
                    </div>
                    <div class="col-auto">
                        <button type="submit" class="btn btn-primary col-auto">검색</button>
                    </div>
                </div>
            </form>
            <div class="table-responsive">
                <table class="table table-striped table-hover align-middle text-nowrap" style="min-width: 1000px;">
                    <thead>
                    <tr>
                        <th>주문번호</th>
                        <th>주문일자</th>
                        <th>썸네일</th>
                        <th>상품명</th>
                        <th>수령인</th>
                        <th>판매가</th>
                        <th>상태</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="order : ${orders}">
                        <td>
                            <button type="button"
                                    th:text="${order.orderNo}"
                                    class="link-primary border-0 bg-transparent text-decoration-underline btn-order-no">202406240000
                            </button>
                        </td>
                        <td th:text="${{order.createAt}}">2024-06-25</td>
                        <td><img th:src="@{/{image} (image=${order.image})}" src="https://via.placeholder.com/100" alt="썸네일 이미지"></td>
                        <td th:text="${order.title}">한번 쓴 ㅇㅇㅇ</td>
                        <td th:text="${order.recipientName}">홍길동</td>
                        <td th:text="${{order.halfPrice}}">5,000</td>
                        <td th:text="${order.stateName}">발송대기</td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <div class="row">
                <nav aria-label="Page navigation example w-auto">
                    <ul class="pagination justify-content-center">
                        <li class="page-item disabled">
                            <a class="page-link" href="#" aria-label="Previous">
                                <span aria-hidden="true">&laquo;</span>
                            </a>
                        </li>
                        <li class="page-item active"><a class="page-link" href="#">1</a></li>
                        <li class="page-item"><a class="page-link" href="#">2</a></li>
                        <li class="page-item"><a class="page-link" href="#">3</a></li>
                        <li class="page-item">
                            <a class="page-link" href="#" aria-label="Next">
                                <span aria-hidden="true">&raquo;</span>
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>
        <div class="row px-2 pb-5 order-detail d-none">
            <h2 class="text-center my-5">주문 상세정보</h2>
            <div class="row">
                <p><strong>주문번호</strong></p>
                <p class="order-no">202406240000</p>
            </div>
            <div class="row">
                <p><strong>주문일자</strong></p>
                <p class="create-at">2024-06-25</p>
            </div>
            <div class="row">
                <p><strong>상품명</strong></p>
                <p class="title">한 번쓴 ㅇㅇㅇ</p>
            </div>
            <div class="row">
                <p><strong>수령인</strong></p>
                <p class="recipient-name">홍길동</p>
            </div>
            <div class="row">
                <p><strong>수령인 휴대전화</strong></p>
                <p class="recipient-phone">01012345678</p>
            </div>
            <div class="row">
                <p><strong>수령지</strong></p>
                <p class="recipient-address">서울시 ㅇㅇㅇ</p>
            </div>
            <div class="row">
                <p><strong>배송메모</strong></p>
                <p class="delivery-memo">안전하게 배송해주세요.</p>
            </div>
            <div class="row mb-4">
                <p class="col-12"><strong>송장번호</strong></p>
                <input type="text" class="form-control mx-2 col-12 w-auto px-2 flex-shrink-0 invoice">
            </div>
            <div class="row gx-0">
                <div class="col-auto mx-2">
                    <button type="button" class="btn btn-primary btn-send-invoice">발송하기</button>
                </div>
                <div class="col-auto mx-2">
                    <button type="button" class="btn btn-outline-danger btn-order-detail-close">닫기</button>
                </div>
            </div>
        </div>
    </div>
    <script th:inline="javascript">

        const searchSelect = document.querySelector(".search-select");
        const searchInput = document.querySelector(".search-input");
        const orderNoBtn = document.querySelectorAll(".btn-order-no");
        const orderDetailCloseBtn = document.querySelector(".btn-order-detail-close");

        const searchConditions = {
            /*[# th:each="searchCond : ${searchConds}"]*/
               [[${searchCond.field}]] : [[${searchCond.name}]],
            /*[/]*/
        };

        const selectedValue = searchSelect.value;
        const placeholder = searchConditions[selectedValue] || "검색어를 입력하세요.";
        searchInput.placeholder = placeholder;
        searchInput.name = selectedValue;

        searchSelect.addEventListener("change", function () {
            const selectedValue = this.value;
            const placeholder = searchConditions[selectedValue] || "검색어를 입력하세요.";
            searchInput.placeholder = placeholder;
            searchInput.name = selectedValue;
        });

        orderNoBtn.forEach(function (btn) {
            btn.addEventListener("click", function () {
                const orderNo = parseInt(this.textContent);
                fetch("/admin/half/order", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: orderNo
                }).then(
                    response => response.json()
                ).then(
                    data => {
                        const orderDetail = document.querySelector(".order-detail");
                        if (orderDetail.classList.contains("d-none")) {
                            orderDetail.classList.toggle("d-none");
                        }
                        orderDetail.querySelector(".order-no").textContent = data.orderNo;
                        orderDetail.querySelector(".create-at").textContent = data.createAt;
                        orderDetail.querySelector(".title").textContent = data.title;
                        orderDetail.querySelector(".recipient-name").textContent = data.recipientName;
                        orderDetail.querySelector(".recipient-phone").textContent = data.recipientPhone;
                        orderDetail.querySelector(".recipient-address").textContent = data.recipientAddress;
                        orderDetail.querySelector(".delivery-memo").textContent = data.deliveryMemo;
                        orderDetail.querySelector(".invoice").value = data.invoice;
                        if (data.invoice) {
                            orderDetail.querySelector(".invoice").readOnly = true;
                            orderDetail.querySelector(".btn-send-invoice").disabled = true;
                        } else {
                            orderDetail.querySelector(".invoice").readOnly = false;
                            orderDetail.querySelector(".btn-send-invoice").disabled = false;
                        }

                    }
                ).catch(
                    error => console.error(error)
                );
            });
            orderDetailCloseBtn.addEventListener("click", function () {
                const orderDetail = document.querySelector(".order-detail");
                if (!orderDetail.classList.contains("d-none")) {
                    orderDetail.classList.toggle("d-none");
                }
            });
        });
    </script>
</main>
</body>
</html>